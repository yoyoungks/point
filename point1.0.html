<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>四维气泡</title>
<style>
  * {margin:0; padding:0; box-sizing:border-box;}
  body, html {width:100%; height:100%; background:#1e293b; overflow:hidden; font-family: 'PingFang SC', sans-serif;}
  #inputBar {position:absolute; bottom:30px; left:50%; transform:translateX(-50%); width:90%; max-width:500px; display:flex; backdrop-filter:blur(12px); background:rgba(255,255,255,0.06); border-radius:40px; padding:10px;}
  #input {flex:1; background:transparent; border:none; color:white; font-size:16px; padding:0 10px; outline:none;}
  button {cursor:pointer; border:none; border-radius:30px; padding:8px 16px; background:rgba(255,255,255,0.12); color:white; margin-left:8px;}
  button:hover {background:rgba(255,255,255,0.2);}
  #exportBtn {position:absolute; top:20px; right:20px; z-index:20;}
</style>
</head>
<body>
<canvas id="c"></canvas>
<div id="inputBar">
  <input id="input" placeholder="写下你现在的一个想法，按回车或点确认...">
  <button id="confirm">确认</button>
</div>
<button id="exportBtn">导出 TXT</button>
<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
const input = document.getElementById("input");
const confirmBtn = document.getElementById("confirm");
const exportBtn = document.getElementById("exportBtn");

let W,H;
function resize(){ W=canvas.width=window.innerWidth; H=canvas.height=window.innerHeight; }
window.addEventListener("resize",resize);
resize();

let bubbles=[];
let id=1;

function createBubble(text){
  let r=Math.max(55, Math.min(140, text.length*9));
  let cx=W/2 + Math.random()*40-20;
  let cy=H/2 + Math.random()*40-20;

  const nodes=[];
  const count=28;
  for(let i=0;i<count;i++){
    let angle=(i/count)*Math.PI*2;
    nodes.push({x:cx + Math.cos(angle)*r, y:cy + Math.sin(angle)*r, ox:Math.cos(angle), oy:Math.sin(angle), speed:0});
  }
  bubbles.push({id:id++, text, x:cx, y:cy, vx:0, vy:0, r, nodes});
}

confirmBtn.onclick = () => {
  if(input.value.trim()){ createBubble(input.value.trim()); input.value=""; }
};
input.addEventListener("keydown", e=>{ if(e.key==="Enter") confirmBtn.onclick(); });

exportBtn.onclick = ()=>{
  let text=bubbles.map((b,i)=> `${i+1}. ${b.text}`).join("\n");
  const blob=new Blob([text],{type:"text/plain;charset=utf-8"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url; a.download="siwei_qipao.txt"; a.click();
  URL.revokeObjectURL(url);
};

function step(){
  ctx.clearRect(0,0,W,H);
  let centerX=W/2, centerY=H/2;

  for(let b of bubbles){
    b.vx += (centerX-b.x)*0.0008 + (Math.random()-0.5)*0.02;
    b.vy += (centerY-b.y)*0.0008 + (Math.random()-0.5)*0.02;
    b.vx*=0.96; b.vy*=0.96;
    b.x+=b.vx; b.y+=b.vy;
  }

  for(let i=0;i<bubbles.length;i++){
    for(let j=i+1;j<bubbles.length;j++){
      let a=bubbles[i], b=bubbles[j];
      let dx=b.x-a.x, dy=b.y-a.y;
      let dist=Math.hypot(dx,dy);
      let min=a.r+b.r-10;
      if(dist<min){ let f=(min-dist)*0.05; dx/=dist; dy/=dist; a.x-=dx*f; a.y-=dy*f; b.x+=dx*f; b.y+=dy*f; }
    }
  }

  for(let b of bubbles){
    let {nodes,x,y,r}=b;
    for(let n of nodes){
      let tx=x+n.ox*r, ty=y+n.oy*r;
      n.x+=(tx-n.x)*0.12; n.y+=(ty-n.y)*0.12;
    }

    ctx.beginPath();
    for(let i=0;i<nodes.length;i++){
      let p=nodes[i], q=nodes[(i+1)%nodes.length];
      let mx=(p.x+q.x)/2,my=(p.y+q.y)/2;
      if(i===0) ctx.moveTo(mx,my); else ctx.quadraticCurveTo(p.x,p.y,mx,my);
    }
    ctx.fillStyle="rgba(255,255,255,0.09)"; ctx.fill();
    ctx.lineWidth=1; ctx.strokeStyle="rgba(255,255,255,0.18)"; ctx.stroke();

    ctx.fillStyle="rgba(255,255,255,0.9)";
    ctx.font="16px 'PingFang SC'";
    ctx.textAlign="center";
    ctx.textBaseline="middle";
    ctx.fillText(b.text,x,y);
  }

  requestAnimationFrame(step);
}
step();
</script>
</body>
</html>
